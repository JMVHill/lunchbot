#!/usr/bin/env python

from slackclient import SlackClient
import signal
import sys
from LunchBot import LunchBot
from DumpBot import DumpBot
from SlackMonitor import SlackMonitor

if len(sys.argv) != 2:
    print >>sys.stderr, "Usage: {} channel".format(sys.argv[0])
    sys.exit(1)
arg_channel = sys.argv[1]

# bot constants
BOT_TOKEN = "<redacted>"

# global slack connection
slackconnection = SlackClient(BOT_TOKEN)

# setup channel monitoring
lunchbot = LunchBot(slackconnection, "lunchbot")
dumpbot = DumpBot(slackconnection, "dumpbot")

slackmonitor = SlackMonitor(slackconnection)
slackmonitor.add_handler_for_channel(lunchbot, arg_channel)

# catch SIGINT, cleanup before exit
def interrupt_handler(signal, frame):
    global slackmonitor
    slackmonitor.teardown()
    sys.exit(2)
signal.signal(signal.SIGINT, interrupt_handler)

# and begin
print "connected, watching #{}...".format(arg_channel)
slackmonitor.run()
